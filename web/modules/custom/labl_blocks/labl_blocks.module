<?php

use Drupal\labl_blocks\Storybook\StoryDiscovery;

/**
 * Implements hook_theme().
 */
function labl_blocks_theme($existing, $type, $theme, $path) {
  $discovery = new StoryDiscovery();
  $definitions = [];
  $module_path = \Drupal::service('extension.path.resolver')->getPath('module', 'labl_blocks');
  foreach ($discovery->discover() as $story) {
    $variables = [
      'storybook_template' => $story['twig_path'],
    ];
    foreach ($story['fields'] as $field) {
      $variables[$field['name']] = $field['default'];
    }

    $definitions[$story['id']] = [
      'variables' => $variables,
      'template' => 'storybook-component',
      'path' => $module_path . '/templates',
    ];
  }

  return $definitions;
}
